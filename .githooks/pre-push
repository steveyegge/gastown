#!/bin/bash
# Block PRs by preventing pushes to arbitrary feature branches.
# Gas Town agents push to main (crew) or polecat/* branches (polecats).
# PRs are for external contributors only.

# Allowed patterns:
#   main, beads-sync  - Direct work branches
#   polecat/*         - Polecat working branches (Refinery merges these)

while read local_ref local_sha remote_ref remote_sha; do
  branch="${remote_ref#refs/heads/}"

  case "$branch" in
    main|beads-sync|polecat/*)
      # Allowed branches
      ;;
    *)
      echo "ERROR: Invalid branch for Gas Town agents."
      echo ""
      echo "Blocked push to: $branch"
      echo ""
      echo "Allowed branches:"
      echo "  main        - Crew workers push here directly"
      echo "  polecat/*   - Polecat working branches"
      echo "  beads-sync  - Beads synchronization"
      echo ""
      echo "Do NOT create PRs. Push to main or let Refinery merge polecat work."
      exit 1
      ;;
  esac
done

exit 0
