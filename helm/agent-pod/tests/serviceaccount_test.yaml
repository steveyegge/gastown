suite: ServiceAccount tests
templates:
  - templates/serviceaccount.yaml
tests:
  - it: creates service account by default
    asserts:
      - isKind:
          of: ServiceAccount
      - hasDocuments:
          count: 1

  - it: does not create when disabled
    set:
      serviceAccount.create: false
    asserts:
      - hasDocuments:
          count: 0

  - it: applies annotations when set
    set:
      serviceAccount.annotations:
        eks.amazonaws.com/role-arn: "arn:aws:iam::role/agent-pod-role"
    asserts:
      - equal:
          path: metadata.annotations["eks.amazonaws.com/role-arn"]
          value: "arn:aws:iam::role/agent-pod-role"

  - it: uses custom name when provided
    set:
      serviceAccount.name: "custom-sa"
    asserts:
      - equal:
          path: metadata.name
          value: custom-sa

  - it: renders with gastown-test values
    values:
      - ../values/gastown-test.yaml
    asserts:
      - isKind:
          of: ServiceAccount
