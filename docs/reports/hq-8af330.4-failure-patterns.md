# Common Failure Patterns for Gas Town Agents

> Report for: hq-8af330.4
> Generated by: file_after_fail
> Date: 2026-01-22

This document catalogs common failure patterns that agents encounter in Gas Town. When you hit one of these, **file it immediately** using `bd create -t bug`.

## 1. Beads System Issues

### JSONL Hash Mismatch
**Symptom:** `WARNING: JSONL file hash mismatch detected`
**When it happens:** During `gt hook`, `bd sync`, or polecat operations
**Root cause:** JSONL export and export_hashes table out of sync
**Impact:** System clears export_hashes and re-exports (usually recovers)
**Filed as:** hq-8af330.1, bd-36869a, hq-3446fc.17

### Database mtime Warning
**Symptom:** `failed to update database mtime: chtimes ... no such file or directory`
**When it happens:** After `bd sync`
**Root cause:** beads.db file doesn't exist in expected location
**Impact:** Warning only, sync completes successfully
**Filed as:** hq-8af330.2, bd-f74e54

### Foreign Key Violations
**Symptom:** `foreign key constraint failed` during cross-rig operations
**When it happens:** Slinging beads with different prefixes (bd- to hq-)
**Root cause:** Dolt FK constraints vs SQLite differences
**Impact:** Operation fails
**Filed as:** bd-3q6.6-1

## 2. Polecat/Sling Issues

### Wrong Bead After Sling
**Symptom:** Polecat shows different bead ID than what was slung
**When it happens:** After sling completes
**Root cause:** Race condition or stale hook state
**Impact:** Agent works on wrong task
**Filed as:** bd-3q6.7-1

### Race Condition at Startup
**Symptom:** Polecat starts before hook_bead is set
**When it happens:** During polecat spawn
**Root cause:** Timing issue between session start and hook configuration
**Impact:** Agent may miss its assigned work
**Filed as:** bd-3q6.8-1

### Session Dies During Startup
**Symptom:** Polecat spawns but session terminates unexpectedly
**When it happens:** During `gt sling` or `gt polecat spawn`
**Root cause:** Various - Claude session issues, auth problems
**Impact:** Work not completed, convoy shows 0/0
**Filed as:** gt-958e7d

### Cross-Rig Sling Routing
**Symptom:** `Error resolving <bead-id>: no issue found`
**When it happens:** Slinging beads to rigs with different prefixes
**Root cause:** bd commands running in wrong directory
**Impact:** Work metadata not stored, hook appears empty
**Filed as:** gt-818dd0, gt-b11b06 (FIXED in commit 803ede2b)

### Molecule Attachment on Closed Issue
**Symptom:** Molecule attachment fails
**When it happens:** When target polecat issue is already closed
**Root cause:** Validation prevents attaching to closed issues
**Impact:** Work cannot be dispatched
**Filed as:** bd-3q6.5-1

## 3. Mail/Communication Issues

### Crew Mail Delivery Failure
**Symptom:** Messages sent via `gt mail send` not received
**When it happens:** Inter-agent communication
**Root cause:** Unknown - needs investigation
**Impact:** Agents miss coordination messages
**Filed as:** hq-cc7214.25

## 4. Git/Merge Queue Issues

### Wrong Branch Comparison
**Symptom:** `gt polecat remove` checks wrong branch
**When it happens:** When removing polecats
**Root cause:** Compares against main instead of feature branch
**Impact:** May reject valid removals
**Filed as:** gt-8ba

### Import Warnings on Pull
**Symptom:** `bd import` warnings after `git pull`
**When it happens:** After merging upstream changes
**Root cause:** JSONL changes from multiple sources
**Impact:** Usually recovers, but confusing
**Filed as:** bd-3q6.9

## 5. Test Failures

### Pre-existing Test Failures
**Symptom:** Tests fail in fresh checkout
**When it happens:** Running `go test` on cmd/bd
**Root cause:** Tests not updated with code changes
**Impact:** Can't verify changes don't break things
**Filed as:** gt-xos

### Cross-Platform Build Failures
**Symptom:** Build fails for windows/amd64
**When it happens:** Cross-compilation
**Root cause:** flock syscall unavailable on Windows
**Impact:** No Windows binaries
**Filed as:** hq-a2cce9

## Filing Guidelines

When you encounter a failure:

1. **Check if already filed**: `bd list --type bug | grep "<keyword>"`
2. **Create with context**:
   ```bash
   bd create -t bug "Clear description" --parent <your-epic> \
     -d "Full error message and reproduction steps"
   ```
3. **Set priority**: P1 for blocking issues, P2 for annoyances, P3 for minor
4. **Link related**: Use `--parent` or mention related beads in description

## Pattern Recognition Tips

Watch for these keywords in output:
- `Warning:` - Usually worth filing
- `Error:` - Definitely file it
- `failed` - File if unexpected
- `mismatch` - Often indicates sync issues
- `not found` - Could be routing or path issues
- `constraint` - Database schema problems
