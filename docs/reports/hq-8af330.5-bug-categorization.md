# Bug Categorization Report

> Report for: hq-8af330.5
> Generated by: file_after_fail
> Date: 2026-01-22

## Executive Summary

- **Total Open Bugs:** 31
- **P0 (Critical):** 1
- **P1 (High):** 5
- **P2 (Medium):** 23
- **P3 (Low):** 2

## Categories

### 1. Beads Database & Sync (10 bugs)

Issues with the beads issue tracking system, database operations, and synchronization.

| ID | Priority | Status | Description |
|----|----------|--------|-------------|
| bd-36869a | P2 | open | JSONL file hash mismatch warning during gt hook |
| bd-f74e54 | P2 | open | bd sync warning: failed to update database mtime |
| bd-3q6.9 | P2 | open | bd import warning on git pull after merge |
| bd-3q6.10 | P2 | open | Auto-import fails: invalid issue type 'merge-request' |
| hq-8af330.1 | P2 | open | JSONL file hash mismatch warning during gt hook |
| hq-8af330.2 | P2 | open | bd sync warning: failed to update database mtime |
| hq-3446fc.17 | P2 | open | bd update triggers JSONL hash mismatch with Dolt backend |
| hq-3446fc.11 | P2 | in_progress | JSONL files still tracked in git despite Dolt-native mode |
| hq-2c5a32 | P2 | open | Daemon database mismatch: expects beads.db but serves dolt |
| bd-3q6.4 | P2 | in_progress | Polecat beads DB shows 'invalid format version' |

**Pattern:** Most issues relate to JSONL/Dolt sync state and database file locations.

### 2. Polecat Lifecycle (8 bugs)

Issues with polecat spawning, session management, and work attachment.

| ID | Priority | Status | Description |
|----|----------|--------|-------------|
| bd-3q6.7-1 | P1 | open | Polecat picks up wrong bead after sling (shows old bead ID) |
| bd-3q6.8-1 | P1 | open | Race condition: polecat starts before hook_bead is set |
| gt-958e7d | P2 | open | Polecat session dies during startup |
| bd-3q6.5-1 | P2 | open | Molecule attachment fails when polecat issue is closed |
| hq-3d01de | P2 | in_progress | Polecats sometimes start without work hooked |
| hq-cc7214.22 | P2 | in_progress | Polecats and crew not loading Claude hooks from parent |
| hq-cyy0 | P2 | in_progress | Warning 'no wisp config for gastown - parked state may have been lost' |
| hq-41k1 | P0 | in_progress | P0: URGENT: Investigate gt hook/mail visibility for hooked work |

**Pattern:** Race conditions and timing issues between spawn and hook configuration.

### 3. Cross-Rig Operations (4 bugs)

Issues when operations span multiple rigs with different prefixes.

| ID | Priority | Status | Description |
|----|----------|--------|-------------|
| bd-3q6.6-1 | P2 | open | Foreign key violation when slinging cross-rig beads |
| gt-4a6fac | P2 | open | formatTrackBeadID external ref format incompatible with bd routing |
| hq-cc7214.26 | P2 | open | Sling fails to set agent hook: issue not found |
| gt-818dd0 | - | **FIXED** | sling can't find cross-rig beads (commit 803ede2b) |
| gt-b11b06 | - | **FIXED** | sling reports work attached but hook is empty (commit 803ede2b) |

**Pattern:** Prefix routing and database resolution across rig boundaries.

### 4. Test Failures (4 bugs)

Pre-existing or introduced test failures blocking verification.

| ID | Priority | Status | Description |
|----|----------|--------|-------------|
| hq-b71884 | P1 | in_progress | Test failures in cmd/bd: TestDetectPrefix, TestShow_ExternalRef |
| gt-xos | P2 | open | Pre-existing test failures in cmd/bd: routing, show, sync tests |
| hq-65ca68 | P2 | open | TestFormatTrackBeadID fails - incorrect formatting logic |
| hq-95ba15 | P2 | open | TestGetAgentBeadID_UsesRigPrefix fails for polecat |
| hq-a2cce9 | P2 | open | TestCrossPlatformBuild fails for windows/amd64 - flock syscall |

**Pattern:** Tests not kept in sync with implementation changes.

### 5. Communication & Mail (2 bugs)

Issues with inter-agent communication systems.

| ID | Priority | Status | Description |
|----|----------|--------|-------------|
| hq-cc7214.25 | P1 | open | Crew mail delivery not working |
| hq-c2rz | P1 | in_progress | gt feed not showing recent activity |

**Pattern:** Message delivery and activity feed visibility.

### 6. Configuration & Settings (2 bugs)

Issues with configuration handling and settings.

| ID | Priority | Status | Description |
|----|----------|--------|-------------|
| hq-cc7214.1 | P3 | open | settings.json needs per-account ANTHROPIC_AUTH_TOKEN support |
| gt-8ba | P2 | open | gt polecat remove checks commits against main instead of feature branch |

### 7. Merge Queue & Refinery (1 bug)

Issues with the merge queue system.

| ID | Priority | Status | Description |
|----|----------|--------|-------------|
| hq-7736e6 | P2 | open | gt mq list does not filter by rig parameter |

## Priority Distribution

```
P0: ████ 1 (3%)
P1: ████████████████ 5 (16%)
P2: ████████████████████████████████████████████████████████████████████████ 23 (74%)
P3: ████ 2 (6%)
```

## Recommendations

### Immediate (P0-P1)
1. **hq-41k1**: Investigate hook/mail visibility - blocking agent work
2. **bd-3q6.7-1, bd-3q6.8-1**: Fix polecat race conditions - causes wrong work
3. **hq-cc7214.25**: Fix mail delivery - blocks coordination
4. **hq-b71884**: Fix test failures - can't verify changes

### Short-term (P2)
1. Consolidate duplicate JSONL mismatch bugs (bd-36869a, hq-8af330.1, hq-3446fc.17)
2. Address cross-rig routing issues systematically
3. Stabilize polecat lifecycle

### Long-term
1. Add integration tests for cross-rig scenarios
2. Document expected database file locations
3. Add retry logic for timing-sensitive operations

## Duplicate Bug Candidates

The following bugs appear to describe the same underlying issues:

1. **JSONL hash mismatch**: bd-36869a, hq-8af330.1, hq-3446fc.17
2. **Database mtime warning**: bd-f74e54, hq-8af330.2
3. **Polecat work visibility**: hq-41k1, hq-3d01de

Consider consolidating these to reduce tracking overhead.
